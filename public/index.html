<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Tele Image AI</title>

<!-- Paystack -->
<script src="https://js.paystack.co/v1/inline.js"></script>

<style>
body{
  font-family: Arial, sans-serif;
  background:#f5f5f5;
  padding:20px;
  text-align:center;
}
.container{
  background:#fff;
  max-width:420px;
  margin:auto;
  padding:20px;
  border-radius:10px;
}
input{
  width:100%;
  padding:12px;
  margin-bottom:10px;
}
button{
  width:100%;
  padding:12px;
  margin-top:8px;
  border:none;
  border-radius:6px;
  font-size:16px;
  cursor:pointer;
}
#genBtn{background:#1976ff;color:#fff;}
#adBtn{background:#ffc107;}
#payBtn{background:#198754;color:#fff;display:none;}
#downloadBtn{
  background:#333;
  color:#fff;
  display:none;
}
img{
  max-width:100%;
  margin-top:15px;
  border-radius:8px;
}
.status{
  margin-top:10px;
  font-weight:bold;
}
</style>
</head>

<body>
<div class="container">
<h2>üé® Tele Image AI</h2>

<input id="prompt" placeholder="Describe image (e.g. lion wearing crown)">

<button id="genBtn" onclick="generateImage()">Generate Image</button>

<button id="adBtn" onclick="watchAd()">üì¢ Watch Ad to Unlock Download</button>

<button id="payBtn" onclick="pay()">üí≥ Pay ‚Ç¶200 to Download</button>

<p class="status" id="status"></p>

<img id="result">

<button id="downloadBtn" onclick="downloadImage()">‚¨áÔ∏è Download Image</button>
</div>

<script>
let lastImageUrl = "";
let unlocked = false;

/* GENERATE IMAGE */
async function generateImage(){
  const prompt = document.getElementById("prompt").value.trim();
  if(!prompt){
    alert("Enter image description");
    return;
  }

  unlocked = false;
  document.getElementById("downloadBtn").style.display = "none";
  document.getElementById("payBtn").style.display = "none";
  document.getElementById("status").innerText = "‚è≥ Generating image...";

  const res = await fetch("/generate",{
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body:JSON.stringify({ prompt })
  });

  const data = await res.json();

  if(!data.image){
    document.getElementById("status").innerText = "‚ùå Failed to generate image";
    return;
  }

  lastImageUrl = data.image;
  document.getElementById("result").src = data.image;
  document.getElementById("status").innerText =
    "‚úÖ Image ready. Watch ad or pay to download.";
  document.getElementById("payBtn").style.display = "block";
}

/* FAKE AD (can be replaced later) */
function watchAd(){
  document.getElementById("status").innerText = "üì∫ Watching ad...";
  setTimeout(()=>{
    unlocked = true;
    document.getElementById("status").innerText = "üîì Download unlocked (Ad)";
    document.getElementById("downloadBtn").style.display = "block";
  }, 5000);
}

/* PAYSTACK */
function pay(){
  let handler = PaystackPop.setup({
    key: "pk_live_193ec0bed7f25a41f8d9ab473ebfdd4d55db13ba",
    email: "user@email.com",
    amount: 200 * 100,
    currency: "NGN",
    callback: function(){
      unlocked = true;
      document.getElementById("status").innerText =
        "üîì Download unlocked (Payment)";
      document.getElementById("downloadBtn").style.display = "block";
    }
  });
  handler.openIframe();
}

/* DOWNLOAD */
async function downloadImage(){
  if(!unlocked){
    alert("Watch ad or pay first");
    return;
  }
  const res = await fetch(lastImageUrl);
  const blob = await res.blob();
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = "tele-image-ai.png";
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);
}
</script>
</body>
</html>
