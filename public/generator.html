<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Tele Tech AI (Text)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>

<body style="font-family:Arial; background:#f4f6f9;">

<div style="
  max-width:600px;
  margin:40px auto;
  padding:20px;
  background:#fff;
  border-radius:10px;
  box-shadow:0 0 10px rgba(0,0,0,.1);
">

<h2 style="text-align:center;">Tele Tech AI (Text)</h2>

<!-- CHAT AREA -->
<div id="chat" style="
  height:300px;
  overflow-y:auto;
  border:1px solid #ddd;
  padding:10px;
  margin-bottom:10px;
">
</div>

<!-- INPUT -->
<textarea id="msg"
  placeholder="Rubuta sakonka a nan..."
  style="width:100%;height:70px;"></textarea>

<button onclick="sendMsg()"
  style="margin-top:10px; padding:10px 20px; background:#28a745; color:#fff; border:none; border-radius:6px;">
  Send
</button>

</div>
<script>
let msgId = 0;

async function sendMsg() {
  const input = document.getElementById("msg");
  const chat = document.getElementById("chat");
  const message = input.value.trim();

  if (!message) return;

  msgId++;
  const userMsgId = "user-" + msgId;

  // üßç‚Äç‚ôÇÔ∏è User message + delete
  chat.innerHTML += `
    <div id="${userMsgId}" style="margin-bottom:10px;">
      <b>You:</b> ${message}
      <button onclick="deleteMsg('${userMsgId}')" 
        style="margin-left:6px;color:red;border:none;background:none;">
        ‚ùå
      </button>
    </div>
  `;

  input.value = "";
  chat.scrollTop = chat.scrollHeight;

  // ü§ñ AI thinking
  msgId++;
  const aiMsgId = "ai-" + msgId;

  chat.innerHTML += `
    <div id="${aiMsgId}" style="margin-bottom:10px;color:gray;">
      <b>AI:</b> Thinking...
      <button onclick="deleteMsg('${aiMsgId}')" 
        style="margin-left:6px;color:red;border:none;background:none;">
        ‚ùå
      </button>
    </div>
  `;
  chat.scrollTop = chat.scrollHeight;

  try {
    const res = await fetch("/chat", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ message })
    });

    const data = await res.json();

    document.getElementById(aiMsgId).innerHTML = `
      <b>AI:</b> ${data.success ? data.reply : "Error"}
      <button onclick="deleteMsg('${aiMsgId}')" 
        style="margin-left:6px;color:red;border:none;background:none;">
        ‚ùå
      </button>
    `;
  } catch {
    document.getElementById(aiMsgId).innerHTML = `
      <b>AI:</b> Server error ‚ùå
      <button onclick="deleteMsg('${aiMsgId}')" 
        style="margin-left:6px;color:red;border:none;background:none;">
        ‚ùå
      </button>
    `;
  }

  chat.scrollTop = chat.scrollHeight;
}

// üóëÔ∏è DELETE MESSAGE ∆äAYA
function deleteMsg(id) {
  const el = document.getElementById(id);
  if (el) el.remove();
}
</script>
</body>
</html>
